#########################################################################
##
## This file is part of the SAMRAI distribution.  For full copyright 
## information, see COPYRIGHT and COPYING.LESSER. 
##
## Copyright:     (c) 1997-2012 Lawrence Livermore National Security, LLC
## Description:   makefile for testing patch data operations 
##
#########################################################################

SAMRAI        = @top_srcdir@
SRCDIR        = @srcdir@
SUBDIR        = source/test/dataops
VPATH         = @srcdir@
TESTTOOLS     = ../testtools
OBJECT        = ../../..

default: check	

include $(OBJECT)/config/Makefile.config

CPPFLAGS_EXTRA	= -DDISPLAY -DNDIM=$(PDIM)  -DTESTING=1

ifneq (,$(findstring libdcomplex, $(SAMRAI_LIBRARY_TARGETS)))
  NUM_TESTS = 20
else
  NUM_TESTS = 14
endif

TEST_NPROCS = @TEST_NPROCS@


SampleIndexData.o:	$(SAMRAI)/source/test/dataops/SampleIndexData.C
	$(CXX) $(CXXFLAGS) $(CPPFLAGS) -c $(SAMRAI)/source/test/dataops/SampleIndexData.C -o $@

indx_dataops:		indx_dataops.o  SampleIndexData.o $(LIBSAMRAIDEPEND) 
	$(CXX) $(CXXFLAGS) $(LDFLAGS) indx_dataops.o SampleIndexData.o $(LIBSAMRAI2D) $(LIBSAMRAI) $(LDLIBS) -o $@

node_hierops:		node_hierops.o  $(LIBSAMRAIDEPEND) 
	$(CXX) $(CXXFLAGS) $(LDFLAGS) node_hierops.o $(LIBSAMRAI2D) $(LIBSAMRAI) $(LDLIBS) -o $@

cell_hierops:		cell_hierops.o  $(LIBSAMRAIDEPEND) 
	$(CXX) $(CXXFLAGS) $(LDFLAGS) cell_hierops.o $(LIBSAMRAI2D) $(LIBSAMRAI) $(LDLIBS) -o $@

cell_patchtest:		cell_patchtest.o  $(LIBSAMRAIDEPEND) 
	$(CXX) $(CXXFLAGS) $(LDFLAGS) cell_patchtest.o $(LIBSAMRAI2D) $(LIBSAMRAI) $(LDLIBS) -o $@

cell_hiertest:		cell_hiertest.o  $(LIBSAMRAIDEPEND) 
	$(CXX) $(CXXFLAGS) $(LDFLAGS) cell_hiertest.o $(LIBSAMRAI2D) $(LIBSAMRAI) $(LDLIBS) -o $@

cell_hiertest3d:	cell_hiertest.o  $(LIBSAMRAIDEPEND) 
	$(CXX) $(CXXFLAGS) $(LDFLAGS) cell_hiertest.o $(LIBSAMRAI3D) $(LIBSAMRAI) $(LDLIBS) -o $@

edge_hiertest:		edge_hiertest.o  $(LIBSAMRAIDEPEND) 
	$(CXX) $(CXXFLAGS) $(LDFLAGS) edge_hiertest.o $(LIBSAMRAI2D) $(LIBSAMRAI) $(LDLIBS) -o $@

face_hiertest:		face_hiertest.o  $(LIBSAMRAIDEPEND) 
	$(CXX) $(CXXFLAGS) $(LDFLAGS) face_hiertest.o $(LIBSAMRAI2D) $(LIBSAMRAI) $(LDLIBS) -o $@

side_hiertest:		side_hiertest.o  $(LIBSAMRAIDEPEND) 
	$(CXX) $(CXXFLAGS) $(LDFLAGS) side_hiertest.o $(LIBSAMRAI2D) $(LIBSAMRAI) $(LDLIBS) -o $@

node_hiertest:		node_hiertest.o  $(LIBSAMRAIDEPEND) 
	$(CXX) $(CXXFLAGS) $(LDFLAGS) node_hiertest.o $(LIBSAMRAI2D) $(LIBSAMRAI) $(LDLIBS) -o $@

cell_cplxtest:		cell_cplxtest.o  $(LIBSAMRAIDEPEND) 
	$(CXX) $(CXXFLAGS) $(LDFLAGS) cell_cplxtest.o $(LIBSAMRAI2D) $(LIBSAMRAI) $(LDLIBS) -o $@

edge_cplxtest:		edge_cplxtest.o  $(LIBSAMRAIDEPEND) 
	$(CXX) $(CXXFLAGS) $(LDFLAGS) edge_cplxtest.o $(LIBSAMRAI2D) $(LIBSAMRAI) $(LDLIBS) -o $@

node_cplxtest:		node_cplxtest.o  $(LIBSAMRAIDEPEND) 
	$(CXX) $(CXXFLAGS) $(LDFLAGS) node_cplxtest.o $(LIBSAMRAI2D) $(LIBSAMRAI) $(LDLIBS) -o $@

face_cplxtest:		face_cplxtest.o  $(LIBSAMRAIDEPEND) 
	$(CXX) $(CXXFLAGS) $(LDFLAGS) face_cplxtest.o $(LIBSAMRAI2D) $(LIBSAMRAI) $(LDLIBS) -o $@

side_cplxtest:		side_cplxtest.o  $(LIBSAMRAIDEPEND) 
	$(CXX) $(CXXFLAGS) $(LDFLAGS) side_cplxtest.o $(LIBSAMRAI2D) $(LIBSAMRAI) $(LDLIBS) -o $@


TARGETS2D=	cell_patchtest \
	        cell_hiertest \
		face_hiertest \
		node_hiertest \
		side_hiertest \
		edge_hiertest \
		cell_hierops \
		node_hierops \
		indx_dataops

ifneq (,$(findstring complex, $(SAMRAI_LIBRARY_TARGETS)))
TARGETS2D+=	cell_cplxtest \
		face_cplxtest \
		node_cplxtest \
		side_cplxtest \
		edge_cplxtest
endif


checkcompile:   $(TARGETS2D) cell_hiertest

check:
	$(MAKE) check2d
	$(MAKE) check3d

check2d:	$(SAMRAI_LIBRARY_TARGETS)
	$(OBJECT)/config/serpa-run $(TEST_NPROCS) ./cell_patchtest 2;

check3d:	cell_patchtest cell_hiertest
	$(OBJECT)/config/serpa-run $(TEST_NPROCS) ./cell_patchtest 3;
	$(OBJECT)/config/serpa-run $(TEST_NPROCS) ./cell_hiertest 3;

libbool:

libchar:

libfloat:

libdcomplex:	cell_cplxtest \
		face_cplxtest \
		node_cplxtest \
		side_cplxtest \
		edge_cplxtest
	$(OBJECT)/config/serpa-run $(TEST_NPROCS) ./cell_cplxtest 2; \
	$(OBJECT)/config/serpa-run $(TEST_NPROCS) ./cell_cplxtest 3; \
	$(OBJECT)/config/serpa-run $(TEST_NPROCS) ./face_cplxtest 2; \
	$(OBJECT)/config/serpa-run $(TEST_NPROCS) ./node_cplxtest 2; \
	$(OBJECT)/config/serpa-run $(TEST_NPROCS) ./edge_cplxtest 2; \
	$(OBJECT)/config/serpa-run $(TEST_NPROCS) ./side_cplxtest 2


libdefault:	cell_patchtest \
		cell_hiertest \
		face_hiertest \
		node_hiertest \
		side_hiertest \
		edge_hiertest \
		cell_hierops \
		node_hierops \
		indx_dataops
	$(OBJECT)/config/serpa-run $(TEST_NPROCS) ./cell_hierops 2; \
	$(OBJECT)/config/serpa-run $(TEST_NPROCS) ./node_hierops 2; \
	$(OBJECT)/config/serpa-run $(TEST_NPROCS) ./indx_dataops 2; \
	$(OBJECT)/config/serpa-run $(TEST_NPROCS) ./cell_hiertest 2; \
	$(OBJECT)/config/serpa-run $(TEST_NPROCS) ./cell_hiertest 3; \
	$(OBJECT)/config/serpa-run $(TEST_NPROCS) ./cell_patchtest 2; \
	$(OBJECT)/config/serpa-run $(TEST_NPROCS) ./cell_patchtest 3; \
	$(OBJECT)/config/serpa-run $(TEST_NPROCS) ./face_hiertest 2; \
	$(OBJECT)/config/serpa-run $(TEST_NPROCS) ./node_hiertest 2; \
	$(OBJECT)/config/serpa-run $(TEST_NPROCS) ./edge_hiertest 2; \
	$(OBJECT)/config/serpa-run $(TEST_NPROCS) ./side_hiertest 2

checktest:
		rm -f makecheck.logfile
		$(MAKE) check 2>&1 | $(TEE) makecheck.logfile
		$(TESTTOOLS)/testcount.sh $(TEST_NPROCS) $(NUM_TESTS) makecheck.logfile
		rm -f makecheck.logfile

clean-check:
		$(SAMCLEAN)

clean:		clean-check
		$(RM) *_hiertest* *_cplxtest* *_patchtest* *_hierops* *_dataops*


include $(SRCDIR)/Makefile.depend

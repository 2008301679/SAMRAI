<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>SAMRAI: SAMRAI::tbox::AsyncCommStage Class Reference</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.4.2 -->
<div class="qindex"><a class="qindex" href="main.html">Main&nbsp;Page</a> | <a class="qindex" href="namespaces.html">Namespace List</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="namespacemembers.html">Namespace&nbsp;Members</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a></div>
<div class="nav">
<a class="el" href="namespaceSAMRAI.html">SAMRAI</a>::<a class="el" href="namespaceSAMRAI_1_1tbox.html">tbox</a>::<a class="el" href="classSAMRAI_1_1tbox_1_1AsyncCommStage.html">AsyncCommStage</a></div>
<h1>SAMRAI::tbox::AsyncCommStage Class Reference</h1>Stage multiple asynchronous group communications so that the collective can advance asynchronously (as individual underlying <a class="el" href="structSAMRAI_1_1tbox_1_1MPI.html">MPI</a> requests are completed).  
<a href="#_details">More...</a>
<p>
<code>#include &lt;source/toolbox/parallel/AsyncCommStage.h&gt;</code>
<p>
<a href="classSAMRAI_1_1tbox_1_1AsyncCommStage-members.html">List of all members.</a><table border="0" cellpadding="0" cellspacing="0">
<tr><td></td></tr>
<tr><td colspan="2"><br><h2>Public Member Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSAMRAI_1_1tbox_1_1AsyncCommStage.html#a0">AsyncCommStage</a> ()</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Construct a stage that may begin allocating and managing groups.  <a href="#a0"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">virtual&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSAMRAI_1_1tbox_1_1AsyncCommStage.html#a1">~AsyncCommStage</a> (void)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Deallocate groups remaining in the stage and all internal data used to manage groups.  <a href="#a1"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="classSAMRAI_1_1tbox_1_1AsyncCommGroup.html">AsyncCommGroup</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSAMRAI_1_1tbox_1_1AsyncCommStage.html#a2">allocateCommGroup</a> (int nchild, <a class="el" href="classSAMRAI_1_1tbox_1_1RelaunchableJob.html">RelaunchableJob</a> *handle=NULL)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Allocate a group in this stage.  <a href="#a2"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="classSAMRAI_1_1tbox_1_1RelaunchableJob.html">RelaunchableJob</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSAMRAI_1_1tbox_1_1AsyncCommStage.html#a3">advanceAny</a> ()</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Advance to completion one group (any group) that is currently waiting for communication to complete.  <a href="#a3"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSAMRAI_1_1tbox_1_1AsyncCommStage.html#a4">advanceSome</a> (<a class="el" href="classSAMRAI_1_1tbox_1_1Array.html">Array</a>&lt; <a class="el" href="classSAMRAI_1_1tbox_1_1RelaunchableJob.html">RelaunchableJob</a> * &gt; &amp;completed)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Advance to completion one or more groups (any groups) that are currently waiting for communication to complete.  <a href="#a4"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSAMRAI_1_1tbox_1_1AsyncCommStage.html#a5">isDone</a> () const </td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Return whether the stage is done with all requested communications.  <a href="#a5"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSAMRAI_1_1tbox_1_1AsyncCommStage.html#a6">numberOfOutstandingGroups</a> () const </td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Return the number of allocated groups that have pending communication.  <a href="#a6"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSAMRAI_1_1tbox_1_1AsyncCommStage.html#a7">numberOfOutstandingRequests</a> () const </td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Return the number of pending <a class="el" href="structSAMRAI_1_1tbox_1_1MPI.html#w2">MPI::request</a> objects.  <a href="#a7"></a><br></td></tr>
<tr><td colspan="2"><br><h2>Friends</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">class&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSAMRAI_1_1tbox_1_1AsyncCommStage.html#n0">StagedGroup</a></td></tr>

</table>
<hr><a name="_details"></a><h2>Detailed Description</h2>
Stage multiple asynchronous group communications so that the collective can advance asynchronously (as individual underlying <a class="el" href="structSAMRAI_1_1tbox_1_1MPI.html">MPI</a> requests are completed). 
<p>
Use this class when you<ul>
<li>Have multiple group communications, each performed by a different <a class="el" href="classSAMRAI_1_1tbox_1_1AsyncCommGroup.html">AsyncCommGroup</a> object.</li><li>Want the multiple communications to proceed independently and asynchronously.</li></ul>
<p>
This class allocates a set of <a class="el" href="classSAMRAI_1_1tbox_1_1AsyncCommGroup.html">AsyncCommGroup</a> objects and manages the space for their <a class="el" href="structSAMRAI_1_1tbox_1_1MPI.html#w2">MPI::request</a>'s. The requests are staged such that a single MPI_Waitany or MPI_Waitsome call applies to all communication groups allocated by the stage. Thus the communications performed by the <a class="el" href="classSAMRAI_1_1tbox_1_1AsyncCommGroup.html">AsyncCommGroup</a> objects can complete in the order allowed by the <a class="el" href="structSAMRAI_1_1tbox_1_1MPI.html">MPI</a> messages. The exact order is NOT deterministic!<p>
To advance the communication operation of any of the allocated <a class="el" href="classSAMRAI_1_1tbox_1_1AsyncCommGroup.html">AsyncCommGroup</a> objects, use <a class="el" href="classSAMRAI_1_1tbox_1_1AsyncCommStage.html#a3">advanceAny()</a> or <a class="el" href="classSAMRAI_1_1tbox_1_1AsyncCommStage.html#a4">advanceSome()</a>. In general, <a class="el" href="classSAMRAI_1_1tbox_1_1AsyncCommStage.html#a4">advanceSome()</a> has better performance than <a class="el" href="classSAMRAI_1_1tbox_1_1AsyncCommStage.html#a3">advanceAny()</a> because it gets around the "starvation" problem. See the <a class="el" href="structSAMRAI_1_1tbox_1_1MPI.html">MPI</a> documentation for a discussion of starvation.<p>
This class supports communication and uses <a class="el" href="structSAMRAI_1_1tbox_1_1MPI.html">MPI</a> for message passing. If <a class="el" href="structSAMRAI_1_1tbox_1_1MPI.html">MPI</a> is disabled, the job of this class disappears and the class is effectively empty, except for allocating and deallocating <a class="el" href="classSAMRAI_1_1tbox_1_1AsyncCommGroup.html">AsyncCommGroup</a> objects. The public interfaces still remain so the class can compile, but the implementations are trivial. 
<p>
<hr><h2>Constructor &amp; Destructor Documentation</h2>
<a class="anchor" name="a0" doxytag="SAMRAI::tbox::AsyncCommStage::AsyncCommStage"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">SAMRAI::tbox::AsyncCommStage::AsyncCommStage           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Construct a stage that may begin allocating and managing groups. 
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a1" doxytag="SAMRAI::tbox::AsyncCommStage::~AsyncCommStage"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">SAMRAI::tbox::AsyncCommStage::~AsyncCommStage           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">void&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [virtual]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Deallocate groups remaining in the stage and all internal data used to manage groups. 
<p>
    </td>
  </tr>
</table>
<hr><h2>Member Function Documentation</h2>
<a class="anchor" name="a2" doxytag="SAMRAI::tbox::AsyncCommStage::allocateCommGroup"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"><a class="el" href="classSAMRAI_1_1tbox_1_1AsyncCommGroup.html">AsyncCommGroup</a> * SAMRAI::tbox::AsyncCommStage::allocateCommGroup           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">int&nbsp;</td>
          <td class="mdname" nowrap> <em>nchild</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="classSAMRAI_1_1tbox_1_1RelaunchableJob.html">RelaunchableJob</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>handle</em> = <code>NULL</code></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Allocate a group in this stage. 
<p>
You may specify a handle associated with the allocated group and pointing back to an object. These pointers are returned when their group communications are completed by the stage methods <a class="el" href="classSAMRAI_1_1tbox_1_1AsyncCommStage.html#a3">advanceAny()</a> or <a class="el" href="classSAMRAI_1_1tbox_1_1AsyncCommStage.html#a4">advanceSome()</a>. They help identify the user object waiting for the communication to complete.<p>
To use the handle, create a user class inheritting from <a class="el" href="classSAMRAI_1_1tbox_1_1RelaunchableJob.html">RelaunchableJob</a> so that any handle can be dynamically casted back to the user class.<p>
Usage outline:<ol type=1>
<li>Derive class UserClass from <a class="el" href="classSAMRAI_1_1tbox_1_1RelaunchableJob.html">RelaunchableJob</a>. Implement the pure virtual interfaces therein.</li><li>Associate a UserClass object with a <a class="el" href="classSAMRAI_1_1tbox_1_1AsyncCommGroup.html">AsyncCommGroup</a> object by using the address of the UserClass object to allocate the group. See <a class="el" href="classSAMRAI_1_1tbox_1_1AsyncCommStage.html#a2">AsyncCommStage::allocateCommGroup()</a>.</li><li>Use the allocated group to initiate a group communication.</li><li>Repeat the above for any number of user objects.</li><li>Determine the specific user object associated with the communication completed by <a class="el" href="classSAMRAI_1_1tbox_1_1AsyncCommStage.html#a3">AsyncCommStage::advanceAny()</a> and <a class="el" href="classSAMRAI_1_1tbox_1_1AsyncCommStage.html#a4">AsyncCommStage::advanceSome()</a> by dynamically casting the output <a class="el" href="classSAMRAI_1_1tbox_1_1RelaunchableJob.html">RelaunchableJob</a> pointer to pointers to UserClass objects.</li></ol>
<p>
Usage example: <div class="fragment"><pre class="fragment">    * class UserClass : RelaunchableJob { ... };
    * UserClass user_object[10];
    * AsyncCommStage stage;
    * for ( i=0; i&lt;10; ++i ) {
    *    AsyncCommGroup *group =
    *      stage.allocateCommGroup( 2, &amp;user_object[i] );
    *    useGroupToInitiateCommunication(group);
    * }
    * RelaunchableJob *handle = stage.advanceAny();
    * UserClass *completed_user_object = dynamic_cast&lt;UserClass*&gt;(handle);
    * </pre></div><p>
Allocating a group with a NULL handle works, but you lose the ability to map a specific communication back to a user object. See <a class="el" href="classSAMRAI_1_1tbox_1_1AsyncCommStage.html#a3">advanceAny()</a> and <a class="el" href="classSAMRAI_1_1tbox_1_1AsyncCommStage.html#a4">advanceSome()</a>.<p>
An allocated group should be deallocated using the delete operator when no longer needed. All allocated groups will be deleted when the stage goes out of scope. Since it is an error to delete a group that has pending message requests, it is also an error to delete a stage that has groups with pending message requests.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>nchild</em>&nbsp;</td><td>Number of child branches per tree node (see <a class="el" href="classSAMRAI_1_1tbox_1_1AsyncCommGroup.html">AsyncCommGroup</a>). </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>handle</em>&nbsp;</td><td>Optional pointer back to a user object associated with the group. See class documentation. </td></tr>
  </table>
</dl>
    </td>
  </tr>
</table>
<a class="anchor" name="a3" doxytag="SAMRAI::tbox::AsyncCommStage::advanceAny"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"><a class="el" href="classSAMRAI_1_1tbox_1_1RelaunchableJob.html">RelaunchableJob</a> * SAMRAI::tbox::AsyncCommStage::advanceAny           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Advance to completion one group (any group) that is currently waiting for communication to complete. 
<p>
This method uses MPI_Waitany, which may be prone to starvation. It is better to use <a class="el" href="classSAMRAI_1_1tbox_1_1AsyncCommStage.html#a4">advanceSome()</a>, which uses MPI_Waitsome, which avoids starvation.<p>
<dl compact><dt><b>Returns:</b></dt><dd>the <a class="el" href="classSAMRAI_1_1tbox_1_1RelaunchableJob.html">RelaunchableJob</a> pointer used to construct the group that is completed. NULL if no group in the stage had incomplete communication. </dd></dl>
    </td>
  </tr>
</table>
<a class="anchor" name="a4" doxytag="SAMRAI::tbox::AsyncCommStage::advanceSome"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">int SAMRAI::tbox::AsyncCommStage::advanceSome           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="classSAMRAI_1_1tbox_1_1Array.html">Array</a>&lt; <a class="el" href="classSAMRAI_1_1tbox_1_1RelaunchableJob.html">RelaunchableJob</a> * &gt; &amp;&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>completed</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Advance to completion one or more groups (any groups) that are currently waiting for communication to complete. 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>completed</em>&nbsp;</td><td><a class="el" href="classSAMRAI_1_1tbox_1_1Array.html">Array</a> space to put handleegies associated with the completed communications.</td></tr>
  </table>
</dl>
<dl compact><dt><b>Returns:</b></dt><dd>number of groups completed or 0 if none have outstanding communication. The strategy pointers corresponding to the completed groups are set in the <code>completed</code> array. </dd></dl>
    </td>
  </tr>
</table>
<a class="anchor" name="a5" doxytag="SAMRAI::tbox::AsyncCommStage::isDone"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">bool SAMRAI::tbox::AsyncCommStage::isDone           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap> const</td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Return whether the stage is done with all requested communications. 
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a6" doxytag="SAMRAI::tbox::AsyncCommStage::numberOfOutstandingGroups"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">bool SAMRAI::tbox::AsyncCommStage::numberOfOutstandingGroups           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap> const</td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Return the number of allocated groups that have pending communication. 
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a7" doxytag="SAMRAI::tbox::AsyncCommStage::numberOfOutstandingRequests"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">bool SAMRAI::tbox::AsyncCommStage::numberOfOutstandingRequests           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap> const</td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Return the number of pending <a class="el" href="structSAMRAI_1_1tbox_1_1MPI.html#w2">MPI::request</a> objects. 
<p>
    </td>
  </tr>
</table>
<hr><h2>Friends And Related Function Documentation</h2>
<a class="anchor" name="n0" doxytag="SAMRAI::tbox::AsyncCommStage::StagedGroup"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">friend class StagedGroup<code> [friend]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<hr>The documentation for this class was generated from the following files:<ul>
<li>source/toolbox/parallel/<a class="el" href="AsyncCommStage_8h.html">AsyncCommStage.h</a><li>source/toolbox/parallel/<a class="el" href="AsyncCommStage_8C.html">AsyncCommStage.C</a></ul>
<hr size="1"><address style="align: right;"><small>Generated on Fri Dec 2 11:33:32 2005 for SAMRAI by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.4.2 </small></address>
</body>
</html>
